const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config();
const token = process.env.TOKEN;

const bot = new TelegramBot(token, { polling: true });
const webAppUrl = 'https://faq-jetbra.netlify.app';


bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    const name = msg.chat.first_name;

    bot.sendMessage(chatId, `–ü—Ä–∏–≤–µ—Ç, ${name}!`).then(() => {
        return bot.sendMessage(chatId, '–¢–µ–±–µ –Ω—É–∂–Ω–∞ –ª–∏—Ü–µ–Ω–∑–∏—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã Jetbrains? \n–¢—ã –ø–æ –∞–¥—Ä–µ—Å—É!\n–¢—É—Ç —Ç—ã –ø–æ–ª—É—á–∏—à—å –ª–∏—Ü–µ–Ω–∑–∏—é All pack + –ø–ª–∞–≥–∏–Ω—ã.\n–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è-–¥–æ 2026–≥–æ–¥–∞. \n\n–í –º–µ–Ω—é —Ç—ã –Ω–∞–π–¥–µ—à—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Å–∞–º—ã–µ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã!');
    }).then(() => {
        return bot.sendSticker(chatId, 'CAADBQADiQMAAukKyAPZH7wCI2BwFxYE');
    }).then(() => {
        return bot.sendMessage(chatId, '–û–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º –ø–æ –Ω–æ–º–µ—Ä—É –ø–æ –°–ë–ü \n\n–ù–æ–º–µ—Ä –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç—É—Ç: \nüëâ||\\+79533402141–û–∑–æ–Ω–±–∞–Ω–∫||\n\n–û–ø–ª–∞—Ç–∏–ª? –ñ–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µüëá', {
            parse_mode: "MarkdownV2",
            reply_markup: {
                keyboard: [
                    [{ text: "–Ø –æ–ø–ª–∞—Ç–∏–ª!" }]
                ],
                resize_keyboard: true,
                one_time_keyboard: true
            }
        });
    }).catch(error => {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
    });
});


bot.onText(/\/help/, (msg) => {
    const chatId = msg.chat.id;

    bot.sendMessage(chatId, `${msg.chat.first_name}, –ø–∏—à–∏ –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å. –ü–æ –º–µ—Ä–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —è –æ—Ç–≤–µ—á—É –≤ —ç—Ç–æ–º —á–∞—Ç–µ.`).catch(error => {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
    });
});

bot.onText(/\/faq/, (msg) => {
    const chatId = msg.chat.id;

    bot.sendMessage(chatId, `–¢—É—Ç —Å–æ–±—Ä–∞–Ω—ã –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã\n\n–ñ–º–∏ FAQ`, {
        parse_mode: "MarkdownV2",
        reply_markup: {
            inline_keyboard: [
                [{text: 'FAQ', web_app: {url: webAppUrl}}]
            ],
            resize_keyboard: true,
            one_time_keyboard: true
        }
    }).catch(error => {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
    });
});

bot.onText(/\/send (.+)/, (msg, match) => {
    const chatId = msg.chat.id;
    const [userId, ...messageArray] = match[1].split(' ');
    const message = messageArray.join(' ');

    bot.sendMessage(userId, message)
        .then(() => {
            bot.sendMessage(chatId, `–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${userId}`).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
            });
        })
        .catch((error) => {
            bot.sendMessage(chatId, `–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: ${error}`).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
            });
        });
});

const paymentInfo = {};

bot.on('photo', async img => {
    const photo = img.photo[img.photo.length - 1];
    const chatId = img.chat.id;
    const targetChatId = '1213801763';

    paymentInfo[targetChatId] = {
        originalChatId: chatId,
        messageId: img.message_id,
        photo: photo.file_id
    };

    await bot.sendPhoto(targetChatId, photo.file_id, {
        caption: `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${img.from.first_name} –æ—Ç–ø—Ä–∞–≤–∏–ª –≤–∞–º —Å–∫—Ä–∏–Ω –æ–± –æ–ø–ª–∞—Ç–µ –∏–ª–∏ —Ñ–µ–π–∫. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å!.`,
        reply_markup: {
            inline_keyboard: [
                [{ text: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É', callback_data: 'confirm_payment' }]
            ]
        }
    }).catch(error => {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ç–æ:', error);
    });
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ–≥–¥–∞ –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å
async function handleAccessYes(chatId) {
    await bot.sendMessage(chatId, '–ö–∞–∫–∞—è —É —Ç–µ–±—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞?', {
        reply_markup: {
            inline_keyboard: [
                [{ text: 'Windows ', callback_data: 'windows' }],
                [{ text: 'Mac –∏–ª–∏ Linux', callback_data: 'mac-or-linux' }]
            ]
        }
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ—Ç
async function handleAccessNo(chatId) {
    await bot.sendMessage(chatId, '–°–ø–µ—Ä–≤–∞ –ø–æ—Å–º–æ—Ç—Ä–∏ —ç—Ç—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:\n' +
        '–ü–û–î–ì–û–¢–û–í–ò–õ –î–õ–Ø –í–ê–° PDF –§–ê–ò–õ –° –ü–û–õ–ù–´–ú –û–ü–ò–°–ê–ù–ò–ï–ú –ü–†–û–¶–ï–°–°–ê + –°–ö–†–ò–ù–´ https://disk.yandex.ru/d/73SS2SfrjGs8Fg –ß–¢–û–ë–´ –ü–û–õ–£–ß–ò–¢–¨ –ü–ê–†–û–õ–¨ –ù–ê–ü–ò–®–ò –ë–û–¢–£ –î–ê–ô –ü–ê–†–û–õ–¨ =)\n' +
    '–ü–û–°–õ–ï –ü–†–û–°–ú–û–¢–†–ê –ò –ü–ï–†–í–ò–ß–ù–û–ô –ü–û–î–ì–û–¢–û–í–ö–ò –í–ï–†–ù–ò–°–¨ –í –í–ï–¢–ö–£ - –î–û–°–¢–£–ü –ï–°–¢–¨');

    // –ó–¥–µ—Å—å —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
}

bot.on('callback_query', async callbackQuery => {
    const chatId = callbackQuery.message.chat.id;

    if (callbackQuery.data === 'confirm_payment') {
        if (paymentInfo && paymentInfo[chatId]) {
            const { originalChatId, messageId, photo } = paymentInfo[chatId];

            await bot.sendMessage(originalChatId, '–û—Ç–ª–∏—á–Ω–æ, –æ–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞, –ø—Ä–æ–¥–æ–ª–∂–∏–º.');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
            await bot.sendMessage(originalChatId, '–£ —Ç–µ–±—è —Å–µ–π—á–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–≥—Ä–∞–º–º—ã? –ò–ª–∏ —Ç—ã —Å—Ä–∞–∑—É –≤–∏–¥–∏—à—å –∑–∞–ø—Ä–æ—Å –ª–∏—Ü–µ–Ω–∑–∏–∏?', {
                reply_markup: {
                    inline_keyboard: [
                        [{ text: '–î–æ—Å—Ç—É–ø –µ—Å—Ç—å', callback_data: 'access_yep'}],
                        [{ text: '–î–æ—Å—Ç—É–ø–∞ –Ω–µ—Ç', callback_data: 'access_noy'}]
                    ]
                }
            });

            delete paymentInfo[chatId];
        } else {
            console.error('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —á–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –æ–±—ä–µ–∫—Ç paymentInfo –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω.');
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (callbackQuery.data === 'access_yep') {
        await handleAccessYes(chatId);
    } else if (callbackQuery.data === 'access_noy') {
        await handleAccessNo(chatId);
    }

    if (callbackQuery.data === 'windows') {
        bot.sendMessage(chatId, '–ü–û–î–ì–û–¢–û–í–ò–õ –î–õ–Ø –í–ê–° PDF –§–ê–ò–õ –° –ü–û–õ–ù–´–ú –û–ü–ò–°–ê–ù–ò–ï–ú –ü–†–û–¶–ï–°–°–ê + –°–ö–†–ò–ù–´ https://disk.yandex.ru/d/73SS2SfrjGs8Fg –ß–¢–û–ë–´ –ü–û–õ–£–ß–ò–¢–¨ –ü–ê–†–û–õ–¨ –ù–ê–ü–ò–®–ò –ë–û–¢–£ –î–ê–ô –ü–ê–†–û–õ–¨ =)\n' +
            '1. –ü–£–ù–ö–¢ –£–¢–†–ê–¢–ò–õ –°–ò–õ–£ (–ö–∞—á–∞–µ–º —Å –æ—Ñ—Ñ —Å–∞–π—Ç–∞ {–¢–í–û–Ø –ü–†–û–ì–†–ê–ú–ú–ê}, —Å—Ç–∞–≤–∏–º –µ–≥–æ –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º, —Ç—Ä–∏–∞–ª –≤–µ—Ä—Å–∏—é.)\n' +
            '\n' +
            '2)–ò–¥–µ–º –Ω–∞ —Å–∞–π—Ç https://3.jetbra.in –∏ –≤—ã–±–∏—Ä–∞–µ–º –∂–∏–≤–æ–π —Å–µ—Ä–≤–µ—Ä -> –∫–∞—á–∞–µ–º –∞—Ä—Ö–∏–≤ jetbra (—Å—Å—ã–ª–∫–∞ –≤ –•—ç–¥–µ—Ä–µ —Å–∞–π—Ç–∞). –†–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º –µ–≥–æ –≤ –ª—é–±–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –ü–ö, –≥–ª–∞–≤–Ω–æ–µ –Ω–µ —É–¥–∞–ª—è—Ç—å. –ü–æ—Å–ª–µ —Ä–∞–∑–∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –∑–∞—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –Ω–µ–π. –ö–æ–ø–∏—Ä—É–µ–º –ø—É—Ç—å –∫ —ç—Ç–æ–π –ø–∞–ø–∫–µ –ø—É—Ç—å –∫ —ç—Ç–æ–π –ø–∞–ø–∫–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!\n' +
            '\n' +
            '3)–ó–∞–ø—É—Å–∫–∞–µ–º {–¢–í–û–Ø –ü–†–û–ì–†–ê–ú–ú–ê} ->–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç. –í–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é  –¥–∞–≤–∏–º Help->Edit custom VM Options. \n' +
            '\n' +
            '4)3. –ë–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –≤—Å—Ç–∞–≤–ª—è–µ–º —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ->  \n' +
            '--add-opens=java.base/jdk.internal.org.objectweb.asm=ALL-UNNAMED   \n' +
            '--add-opens=java.base/jdk.internal.org.objectweb.asm.tree=ALL-UNNAMED   \n' +
            '-javaagent:\\Users\\–¢–£–¢ –ò–ú–Ø –Æ–ó–ï–†–ê\\–¢–£–¢ –ú–´ –ö–ê–ö –†–ê–ó –î–û–õ–ñ–ù–´ –í–°–¢–ê–í–ò–¢–¨ –°–í–û–ô –ü–£–¢–¨ –î–û –ü–ê–ü–ö–ò\\jetbra\\ja-netfilter.jar=jetbrains  \n' +
            '–í—Å–µ –¥–µ—Ñ–∏—Å—ã—Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏!!! \n' +
            '-javaagent:\\Users\\–¢–£–¢ –ò–ú–Ø –Æ–ó–ï–†–ê\\–¢–£–¢ –ú–´ –ö–ê–ö –†–ê–ó –î–û–õ–ñ–ù–´ –í–°–¢–ê–í–ò–¢–¨ –°–í–û–ô –ü–£–¢–¨ –î–û –ü–ê–ü–ö–ò\\jetbra\\ja-netfilter.jar=jetbrains  - –¢–£–¢ –ú–´ –í–°–¢–ê–í–õ–Ø–ï–ú –¢–û–¢ –ü–£–¢–¨, –ö–û–¢–û–†–´–ô –ö–û–ü–ò–†–û–í–ê–õ–ò –í –ë–£–§–ï–† –û–ë–ú–ï–ù–ê –î–û –¢–û–ô –°–ê–ú–û–ô –ü–ê–ü–ö–ò, –ö–û–¢–û–†–£–Æ –°–ö–ê–ß–ê–õ–ò!\n' +
            '–ü–†–ò–ú–ï–†:\n' +
            '--add-opens=java.base/jdk.internal.org.objectweb.asm=ALL-UNNAMED--add-opens=java.base/jdk.internal.org.objectweb.asm.tree=ALL-UNNAMED\n' +
            '-javaagent:\\Users\\Alex\\wsActivate\\jetbra\\jetbra\\ja-netfilter.jar=jetbrains\n' +
            '5)–ù–∞ —Ç–æ–º –∂–µ —Å–∞–π—Ç–µ –≥–¥–µ –∫–∞—á–∞–ª–∏ –ø–∞–ø–∫—É –∫–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ {–¢–í–û–Ø –ü–†–û–ì–†–ê–ú–ú–ê} –ó–∞–ø—É—Å–∫–∞–µ–º {–¢–í–û–Ø –ü–†–û–ì–†–ê–ú–ú–ê} -> help -> registr -> activate new license->activation code \n' +
            '–∏ –≤ –ø–æ–ª–µ –≤—Å—Ç–∞–≤–ª—è–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á —Å —Å–∞–π—Ç–∞. –ñ–º–µ—Ç activate –∏ –≤—Å–µ –æ–∫' );
    } else if (callbackQuery.data === 'mac-or-linux') {
        bot.sendMessage(chatId, '–ù–∞ –º–∞–∫–µ –∏–ª–∏ –ª–∏–Ω—É–∫—Å, —Ä–∞–∑–Ω–∏—Ü–∞ –æ—Ç –≤–∏–Ω–¥—ã –ª–∏—à—å –≤ —Ç–æ–º, —á—Ç–æ –≤ —ç—Ç–æ–π —Å—Ç—Ä–æ—á–∫–µ:' +
        '-javaagent:\\Users\\–ò–ú–Ø –¢–í–û–ï–ô –°–ò–°–¢–ï–ú–´\\*\\*\\*\\jetbra\\ja-netfilter.jar=jetbrains –°–õ–≠–®–ò –í –ü–£–¢–ò –í –î–†–£–ì–£–Æ –°–¢–û–†–û–ù–£, –î–£–ú–ê–Æ –°–ê–ú –ü–û–ô–ú–ï–®–¨)))\n' +
        '–ü–æ—ç—Ç–æ–º—É –≤—ã–±–∏—Ä–∞–π windows –∏ —Å–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏');
    }
});


bot.on('message', async (msg) => {
    const chatId = msg.chat.id;
    const messageText = msg.text || {};
    const userId = msg.from.id;
    const { video, sticker, audio, voice, video_note, document, animation } = msg;

    if (msg.photo) {
        await bot.sendMessage(chatId, '–°–ø–∞—Å–∏–±–æ, –ø—Ä–æ–≤–µ—Ä—è—é –æ–ø–ª–∞—Ç—É. –°–∫–æ—Ä–æ –≤–µ—Ä–Ω—É—Å—å..–û–∂–∏–¥–∞–π—Ç–µ.', {
            reply_markup: { remove_keyboard: true }
        });
    } else if (video || sticker || audio || voice || video_note || document || animation) {
        await bot.sendMessage(chatId, `–ü—Ä–∏—à–ª–∏ —Å–∫—Ä–∏–Ω –æ–ø–ª–∞—Ç—ã —Å—é–¥–∞ –≤ —á–∞—Ç. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –º—ã —Å–º–æ–∂–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.`);
    } else {
        const replyText = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –ø—Ä–∏—Å–ª–∞–ª: ${messageText || video || sticker || audio || voice || video_note || document || animation}`;
        await bot.sendMessage('1213801763', replyText, {
            reply_markup: {
                inline_keyboard: [[{ text: '–û—Ç–≤–µ—Ç–∏—Ç—å —é–∑–µ—Ä—É', callback_data: JSON.stringify({ userId: userId }) }]]
            }
        });
    }
});

bot.on('message', async (msg) => {
    const chatId = msg.chat.id;
    const messageText = msg.text;

    if (messageText === "–Ø –æ–ø–ª–∞—Ç–∏–ª!") {
        await bot.sendMessage(chatId, '–û—Ç–ª–∏—á–Ω–æ, –ø—Ä–∏—à–ª–∏ –º–Ω–µ —Å–∫—Ä–∏–Ω –æ–ø–ª–∞—Ç—ã —Å—é–¥–∞ –≤ —á–∞—Ç. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –º—ã –ø—Ä–æ–¥–æ–ª–∂–∏–º. –°–ø–∞—Å–∏–±–æ.', {
            reply_markup: { remove_keyboard: true }
        });
    }
});

bot.on('callback_query', (callbackQuery) => {
    const userId = JSON.parse(callbackQuery.data).userId;

    bot.answerCallbackQuery(callbackQuery.id)
        .then(() => {
            bot.sendMessage(callbackQuery.message.chat.id, `/send ${userId}`);
        });
});


console.log('bot started')